#!name=YouTube
#!desc=移除广告。
#!icon=https://rucu6.pages.dev/Icons/app/youtube.png
#!homepage=https://github.com/dqzboy/Loon_Surge_Rule
#!author=dqzboy

[Rule]
AND,((DOMAIN,youtubei.googleapis.com),(PROTOCOL,UDP)),REJECT
AND,((DOMAIN-SUFFIX,googlevideo.com),(PROTOCOL,UDP)),REJECT

[URL Rewrite]
# youtube 短链移除追踪参数
(^https:\/\/youtu\.be\/[\w-]+)(?:\?si=\w+) $1 302

[Map Local]
# loon 专用写法
^https:\/\/rr[\w-]+\.googlevideo\.com\/initplayback\? data-type=text data="" header="Content-Type:text/plain"

[Script]
youtube_ads = type=http-response, pattern=^https:\/\/youtubei\.googleapis\.com\/youtubei\/v1\/(?:browse|next|player|search|reel\/reel_watch_sequence|guide|account\/get_setting|get_watch), script-path=https://rucu6.pages.dev/Scripts/youtube.js, requires-body=true, binary-body-mode=true, argument="[{{{blockImmersive}}},{{{blockShorts}}},{{{blockUpload}}},{{{debug}}},{{{captionLang}}},{{{lyricLang}}}]"

[MITM]
hostname = %APPEND% rr*.googlevideo.com, youtu.be, youtubei.googleapis.com

